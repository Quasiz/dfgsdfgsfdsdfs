import argparse
import socket
import time

def send_udp(ip, port, packet_size, duration):
    # Create a UDP socket
    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

    # Data for the packet
    data = b'X' * packet_size

    start_time = time.time()
    end_time = start_time + duration
    requests_sent = 0

    try:
        while time.time() < end_time:
            # Send the UDP packet to the IP address and port
            udp_socket.sendto(data, (ip, port))
            requests_sent += 1
        print(f"Sent {requests_sent} UDP packets in {duration} seconds.")
    except Exception as e:
        print(f"Error sending UDP packets: {e}")
    finally:
        # Close the socket
        udp_socket.close()

if __name__ == "__main__":
    # Parse command-line arguments
    parser = argparse.ArgumentParser(description="Send UDP packets to an IP address and port for a specified duration.")
    parser.add_argument("ip", type=str, help="The IP address of the target server")
    parser.add_argument("port", type=int, help="The target port")
    parser.add_argument("packet_size", type=int, help="The size of the packet to be sent in bytes")
    parser.add_argument("duration", type=float, help="The duration in seconds for sending UDP packets")
    args = parser.parse_args()

    # Call the function to send UDP packets
    send_udp(args.ip, args.port, args.packet_size, args.duration)
